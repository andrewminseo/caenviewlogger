<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAENView Monitoring Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .room-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            transition: transform 0.2s;
            cursor: pointer;
        }
        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .room-header {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .status-label {
            font-weight: 500;
        }
        .status-ok {
            color: green;
        }
        .status-warning {
            color: orange;
        }
        .status-error {
            color: red;
        }
        .logs-container {
            margin-top: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .log-entry {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .log-timestamp {
            color: #777;
            font-size: 0.9em;
        }
        .log-message {
            margin-top: 5px;
        }
        .iframe-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            margin-top: 20px;
        }
        .responsive-iframe {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        #caenview-tab, #logs-tab {
            display: none;
        }
        .tab-active {
            display: block !important;
        }
        .tab-button {
            padding: 10px 20px;
            border: none;
            background-color: #f1f1f1;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab-button.active {
            background-color: #4285f4;
            color: white;
        }
        .tab-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="dashboard-header">
            <h1>CAENView Monitoring Dashboard</h1>
            <div>
                <span id="status-indicator" class="badge bg-success">Connected</span>
                <span id="last-update" class="text-secondary ms-2">Last update: Just now</span>
            </div>
        </div>

        <div class="btn-group mb-4">
            <button class="tab-button active" id="dashboard-btn">Dashboard</button>
            <button class="tab-button" id="caenview-btn">CAENView (Original)</button>
            <button class="tab-button" id="logs-btn">Activity Logs</button>
        </div>

        <div id="dashboard-tab">
            <div class="alert alert-info">
                <strong>Info:</strong> This dashboard provides a summary view of all rooms monitored in CAENView.
                Click on a room card to see more details.
            </div>
            
            <div class="d-flex justify-content-between mb-3">
                <div class="input-group" style="width: 300px;">
                    <input type="text" id="search-input" class="form-control" placeholder="Search rooms...">
                    <button class="btn btn-outline-secondary" type="button" id="search-button">Search</button>
                </div>
                <div>
                    <select id="filter-building" class="form-select">
                        <option value="all">All Buildings</option>
                        <option value="Beyster">Beyster</option>
                        <option value="Chrysler">Chrysler</option>
                        <option value="Cooley">Cooley</option>
                        <option value="CSRB">CSRB</option>
                        <option value="DC">DC</option>
                        <option value="Dow">Dow</option>
                        <option value="EECS">EECS</option>
                        <option value="FXB">FXB</option>
                        <option value="GGB">GGB</option>
                        <option value="IOE">IOE</option>
                    </select>
                </div>
            </div>
            
            <div class="room-grid" id="rooms-container">
                <!-- Room cards will be inserted here -->
            </div>
        </div>

        <div id="caenview-tab">
            <div class="iframe-container">
                <iframe id="caenview-iframe" class="responsive-iframe" src="https://caenview.engin.umich.edu/" allow="fullscreen"></iframe>
            </div>
        </div>

        <div id="logs-tab">
            <h2>Activity Logs</h2>
            <div class="mb-3">
                <button id="export-logs" class="btn btn-primary">Export Logs</button>
                <button id="clear-logs" class="btn btn-danger ms-2">Clear Logs</button>
            </div>
            <div class="logs-container" id="logs-list">
                <!-- Log entries will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Sample room data based on the provided text (in a real scenario, this would be fetched from CAENView)
        const roomData = [
            { building: "Beyster", room: "1620", name: "Mellor Family Laboratory", power: "ok", source: "ok", projector: [{ hours: 0 }], mics: null, cameraStatus: "error" },
            { building: "Beyster", room: "1670", power: "ok", source: "ok", projector: [{ hours: 4511 }, { hours: 4511 }], mics: { expected: 2, actual: 2 }, cameraStatus: "error" },
            { building: "Beyster", room: "1690", power: "ok", source: "ok", projector: [{ hours: 0 }, { hours: 0 }], mics: { expected: 2, actual: 2 }, cameraStatus: "error" },
            { building: "Chrysler", room: "133", power: "ok", source: "ok", pr
